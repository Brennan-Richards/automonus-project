{% extends 'base.html' %}

{% block content %}

{% if user.profile.get_user_institutions %}

<h1 class="text-center">Tyler's Whiteboards</h1>

<div class="col-lg-8 offset-lg-2">
  <div class="card shadow mb-4 p-4">
    <p>Your P/L: ${{ aggregate_pl }}</p>
    <p>Profit withdrawn: ${{ adjustment }}</p>
    <hr>
    <p>Real P/L: ${{ real_profit_or_loss }}</p>
  </div>

  <div class="col-lg-4 offset-lg-2">
    {% if user.profile.get_user_institutions %}
      <button id="data-update" class="btn btn-sm btn-block btn-secondary m-2">Update ThinkorSwim Data</button>
    {% else %}
      <a href="{% url 'link_institution' %}" class="btn btn-sm btn-block btn-secondary m-2">Add Your Account</a>
    {% endif %}
  </div>

  <div class="col-lg-4">
    {% if adjustment %}
      <a href="{% url 'tylers_adjustment_update' request.user.tylersadjustment.id %}" class="btn btn-sm btn-block btn-primary m-2">Update Adjustment Value</a>
    {% else %}
      <a href="{% url 'tylers_adjustment_create' %}" class="btn btn-sm btn-block btn-primary m-2">Add Adjustment Value</a>
    {% endif %}
  </div>

</div>

{% else %}

  <div class="row">
    <div class="col-lg-12 text-center">
      <p>
        Tyler, add your TD Ameritrade account to access ThinkorSwim data.
      </p>
      <a class="btn btn-primary" href="{% url 'link_institution' %}">
        Connect With Your Financial Institution
      </a>
    </div>
  </div>

{% endif %}

{% block js_stuff %}

  <script type="text/javascript">
    console.log("JS");
    var dataupdate = document.getElementById('data-update');

    $(dataupdate).on('click', function(e){
        console.log("Clicked");
        fetch('update_account_info/', {
            method: 'post',
            headers: {
              'Content-Type': 'application/json'
            },
        }).then(function(response){
          window.location.href = "{% url 'tylers_whiteboards' %}";
        });

      });
  </script>


{% endblock js_stuff %}


{% endblock content %}
